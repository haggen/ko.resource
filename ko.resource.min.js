/*
 * Knockout Resource v0.4 2012-08-29 19:35:17 -0300
 * by Arthur Corenzan <arthur@corenzan.com>
 * licensed under http://creativecommons.org/licenses/by/3.0
 * more on http://github.com/haggen/ko.resource
 */
(function(k,e){var m,g;m=function(){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(g){return new XMLHttpRequest}}};g=function(e,g,f,i){var b=m();b.open(e,g,!0);b.onreadystatechange=function(){4===b.readyState&&i(JSON.parse(b.responseText))};b.setRequestHeader("Content-Type","application/javascript");b.send(f||null)};k.resource=function(h,l,f){var i;l===e&&(l={});f===e&&(f={});i=function(b){var j,c=this;b===e&&(b={});for(j in f)f.hasOwnProperty(j)&&
(c[j]=f[j]instanceof Function?function(){f[j].apply(c,arguments)}:f[j]);c.serialize=function(){var a,d,b=k.toJS(c);for(a in b)if(b.hasOwnProperty(a))if(0===a.indexOf("__")||b[a]instanceof Function)delete b[a];else if(b[a]instanceof Array)for(d=0;d<b[a].length;d++)"serialize"in b[a][d]&&(b[a][d]=b[a][d].serialize());return b};c.update_attributes=function(a){for(var d in a)if(a.hasOwnProperty(d))if(c[d]===e)c[d]=a[d]instanceof Function?k.computed(a[d],c):a[d]instanceof Array?k.observableArray(a[d]):
k.observable(a[d]);else c[d](a[d])};c.save=function(a){"_id"in c?g("put",h+"/"+c._id(),c.serialize(),function(d){a.call!==e&&a.call(c,d)}):g("post",h,c.serialize(),function(d){c.update_attributes({_id:d._id});a.call!==e&&a.call(c,d)})};c.fetch=function(a){g("get",h+"/"+c._id(),null,function(d){c.update_attributes(d);a.call!==e&&a.call(c,d)})};c.destroy=function(a){g("delete",h+"/"+c._id(),function(d){a.call!==e&&a.call(c,d)})};c.request=function(a,d,b,f){f===e&&(f=b,b={});g(a,h+d,b,function(a){f.call(c,
a)})};c.update_attributes(l);c.update_attributes(b instanceof String?JSON.parse(b):b);c.initialize!==e&&c.initialize(b)};i.fetch=function(b){b instanceof Function&&(b={});g("get",h,b,function(b){var c,a=[];for(c=0;c<b.length;c++)a.push(new i(b[c]));return a})};return i}})(window.ko);
