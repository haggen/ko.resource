/*
 * Knockout Resource v0.4 2012-08-29 19:35:17 -0300
 * by Arthur Corenzan <arthur@corenzan.com>
 * licensed under http://creativecommons.org/licenses/by/3.0
 * more on http://github.com/haggen/ko.resource
 */
(function(j,i){var m,g;m=function(){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(h){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(g){return new XMLHttpRequest}}};g=function(h,g,f,i){var d,e="",b=m();if(h.match(/get|delete/i)&&f instanceof Object){e=[];for(d in f)f.hasOwnProperty(d)&&e.push(d+"="+f[d]);e="?"+e.join("&")}console.log("Request:",h,g+e);b.open(h,g+e,!0);b.onreadystatechange=function(){4===b.readyState&&i(JSON.parse(b.responseText||""))};b.send(f||null)};j.resource=function(h,
l,f){var k;l===i&&(l={});f===i&&(f={});k=function(d){var e,b=this;d===i&&(d={});for(e in f)f.hasOwnProperty(e)&&(b[e]=f[e]instanceof Function?function(){f[e].apply(b,arguments)}:f[e]);b.serialize=function(){var a,c,d=j.toJS(b);for(a in d)if(d.hasOwnProperty(a))if(0===a.indexOf("__")||d[a]instanceof Function)delete d[a];else if(d[a]instanceof Array)for(c=0;c<d[a].length;c++)"serialize"in d[a][c]&&(d[a][c]=d[a][c].serialize());return d};b.update_attributes=function(a){for(var c in a)if(a.hasOwnProperty(c))if(b[c]===
i)b[c]=a[c]instanceof Function?j.computed(a[c],b):a[c]instanceof Array?j.observableArray(a[c]):j.observable(a[c]);else b[c](a[c])};b.save=function(a){"_id"in b?g("put",h+"/"+b._id(),b.serialize(),function(c){a&&a.call&&a.call(b,c)}):g("post",h,b.serialize(),function(c){b.update_attributes({_id:c._id});a&&a.call&&a.call(b,c)})};b.fetch=function(a){g("get",h+"/"+b._id(),null,function(c){b.update_attributes(c);a&&a.call&&a.call(b,c)})};b.destroy=function(a){g("delete",h+"/"+b._id(),function(c){a&&a.call&&
a.call(b,c)})};b.request=function(a,c,d,e){e===i&&(e=d,d={});g(a,h+c,d,function(a){e.call(b,a)})};b.update_attributes(l);b.update_attributes(d instanceof String?JSON.parse(d):d);b.initialize!==i&&b.initialize(d)};k.fetch=function(d,e){d instanceof Function&&(e=d,d={});g("get",h,d,function(b){var a,c=[];for(a=0;a<b.length;a++)c.push(new k(b[a]));e(c)})};return k}})(window.ko);
